<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- 基本資訊 -->
    <title>2026 家族旅行 - 冬季京阪五日遊 v1.80 (Last update: 2026/01/30 10:52)</title>
    <meta name="description" content="2026 年 2 月日本關西家族旅行完整行程規劃，含交通、住宿、長輩友善安排與每日時間軸。" />

    <!-- Open Graph（LINE / Facebook / Messenger 會用） -->
    <meta property="og:title" content="2026 家族旅行｜冬季京阪五日遊" />
    <meta property="og:description" content="一頁式互動行程表，整理 2026 年 2 月京阪家族旅行的交通、景點與時間規劃。" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://tfhsiao.github.io/2026FamilyWinterTrip_Plan/" />
    <meta property="og:image" content="https://tfhsiao.github.io/2026FamilyWinterTrip_Plan/line-cover.png" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:locale" content="zh_TW" />

    <!-- 使用 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>

    <!-- 字型 -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Noto Sans TC', sans-serif; }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin: auto;
            height: 300px;
        }
        @media (min-width: 768px) {
            .chart-container { height: 350px; }
        }
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f5f5f4; 
        }
        ::-webkit-scrollbar-thumb {
            background: #d6d3d1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a29e; 
        }

        .tab-active {
            border-bottom: 3px solid #d97706; /* amber-600 */
            color: #78350f; /* amber-900 */
            font-weight: 700;
        }
        .timeline-line {
            position: absolute;
            left: 1.25rem;
            top: 2.5rem;
            bottom: 0;
            width: 2px;
            background-color: #e7e5e4; /* stone-200 */
            z-index: 0;
        }
        .regulation-card {
            @apply border border-stone-200 rounded-xl p-4 bg-white shadow-sm;
        }
        .regulation-title {
            @apply font-bold text-lg mb-3 flex items-center gap-2;
        }
        .reg-list {
            @apply list-disc list-outside ml-4 space-y-1 text-sm text-stone-600;
        }
    </style>
</head>

<body class="bg-stone-50 text-stone-800 min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-5xl mx-auto px-4 py-4 flex justify-between items-center">
            <div>
                <h1 class="text-xl md:text-2xl font-bold text-stone-900 tracking-tight">
                    2026 家族旅行 - 冬季京阪五日遊 <span class="text-sm font-normal text-stone-400 ml-1">v1.80 (Last update: 2026/01/30 10:52)</span>
                </h1>
                <p class="text-sm text-stone-500">2026/02/25 - 03/01 • 大阪 & 京都</p>
            </div>
            <div class="hidden md:block">
                <span id="countdown-badge" class="bg-amber-100 text-amber-800 text-xs font-bold px-3 py-1 rounded-full">
                    計算中...
                </span>
            </div>
        </div>
        <!-- Navigation -->
        <nav class="max-w-5xl mx-auto px-4 mt-2">
            <div class="flex space-x-6 overflow-x-auto no-scrollbar">
                <button onclick="switchTab('overview')" id="nav-overview" class="tab-active py-3 text-sm md:text-base whitespace-nowrap transition-colors hover:text-amber-800">總覽 Overview</button>
                <button onclick="switchTab('itinerary')" id="nav-itinerary" class="py-3 text-sm md:text-base whitespace-nowrap text-stone-500 transition-colors hover:text-amber-800">每日行程 Itinerary</button>
                <button onclick="switchTab('logistics')" id="nav-logistics" class="py-3 text-sm md:text-base whitespace-nowrap text-stone-500 transition-colors hover:text-amber-800">住宿與交通 Info</button>
                <button onclick="switchTab('stats')" id="nav-stats" class="py-3 text-sm md:text-base whitespace-nowrap text-stone-500 transition-colors hover:text-amber-800">預算與清單 Budget</button>
                <button onclick="switchTab('regulations')" id="nav-regulations" class="py-3 text-sm md:text-base whitespace-nowrap text-stone-500 transition-colors hover:text-amber-800">法規須知 Regulations</button>
            </div>
        </nav>
    </header>

    <!-- Main Content Area -->
    <main class="flex-grow max-w-5xl mx-auto px-4 py-6 w-full space-y-8">

        <!-- VIEW: OVERVIEW -->
        <section id="view-overview" class="animate-fade-in space-y-6">
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-stone-100">
                <h2 class="text-xl font-bold mb-2 text-stone-800">👋 歡迎來到家族旅行計畫</h2>
                <p class="text-stone-600 leading-relaxed">
                    這份互動式行程表整合了我們 2026 年 2 月底前往日本關西的所有細節。
                    請點選上方的「每日行程」查看詳細的時間安排，或在「住宿與交通」確認飯店資訊。
                </p>
            </div>

            <!-- Google Maps Link Section -->
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-stone-100 border-l-4 border-amber-500">
                <h2 class="text-xl font-bold mb-3 text-stone-800 flex items-center">
                    <span>📍 行程景點標示圖</span>
                </h2>
                <a href="https://maps.app.goo.gl/n68ARSdaFCDV2Uu17" target="_blank" class="inline-flex items-center justify-center w-full md:w-auto px-6 py-3 bg-amber-50 text-amber-800 font-bold rounded-lg hover:bg-amber-100 transition border border-amber-200 mb-2 group">
                    <span class="mr-2">🗺️</span>
                    <span class="group-hover:underline">點此開啟 Google Maps 景點清單</span>
                </a>
                <p class="text-sm text-stone-500 mt-2">
                    💡 <span class="font-bold">註記：</span>請把要去的景點/地區於這個連結內地圖標示，方便大家查看位置與距離。
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Weather Chart Card -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-stone-100">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold text-stone-700">🗓️ 預測天氣 (2/25-3/1)</h3>
                        <span class="text-xs text-stone-400">白天平均氣溫 °C</span>
                    </div>
                    <div class="chart-container">
                        <canvas id="weatherChart"></canvas>
                    </div>
                    <p class="text-xs text-stone-500 mt-2 text-center">建議穿著：早晚溫差大 (低至0°C)。<span class="text-amber-700 font-bold">城崎溫泉恐有雪</span>，請備妥防滑鞋與保暖大衣。</p>
                </div>

                <!-- Quick Stats Card -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-stone-100 flex flex-col justify-center space-y-4">
                    <h3 class="font-bold text-stone-700 mb-2">📊 旅行重點摘要</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-stone-50 p-4 rounded-xl text-center">
                            <div class="text-2xl mb-1">✈️</div>
                            <div class="text-sm text-stone-500">飛行時間</div>
                            <div class="font-bold text-stone-800">2h 40m</div>
                        </div>
                        <div class="bg-stone-50 p-4 rounded-xl text-center">
                            <div class="text-2xl mb-1">🍜</div>
                            <div class="text-sm text-stone-500">預訂餐廳</div>
                            <div class="font-bold text-stone-800">1 間</div>
                        </div>
                        <div class="bg-stone-50 p-4 rounded-xl text-center">
                            <div class="text-2xl mb-1">👣</div>
                            <div class="text-sm text-stone-500">預估步數/日</div>
                            <div class="font-bold text-stone-800">14,000</div>
                        </div>
                        <div class="bg-stone-50 p-4 rounded-xl text-center">
                            <div class="text-2xl mb-1">💴</div>
                            <div class="text-sm text-stone-500">人均已付</div>
                            <div class="font-bold text-stone-800">$35,640</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- VIEW: ITINERARY -->
        <section id="view-itinerary" class="hidden space-y-6">
            <div class="bg-white p-4 rounded-2xl shadow-sm border border-stone-100 sticky top-28 z-40">
                <p class="text-sm text-stone-500 mb-3 text-center">點擊日期切換行程</p>
                <div class="flex justify-between items-center md:justify-center md:space-x-4">
                    <button onclick="renderDailyPlan(1)" id="day-btn-1" class="day-selector flex flex-col items-center p-2 rounded-lg transition hover:bg-stone-100 bg-amber-100 ring-2 ring-amber-400">
                        <span class="text-xs font-bold text-stone-500">2/25</span>
                        <span class="font-bold text-stone-800">Day 1</span>
                    </button>
                    <button onclick="renderDailyPlan(2)" id="day-btn-2" class="day-selector flex flex-col items-center p-2 rounded-lg transition hover:bg-stone-100">
                        <span class="text-xs font-bold text-stone-500">2/26</span>
                        <span class="font-bold text-stone-800">Day 2</span>
                    </button>
                    <button onclick="renderDailyPlan(3)" id="day-btn-3" class="day-selector flex flex-col items-center p-2 rounded-lg transition hover:bg-stone-100">
                        <span class="text-xs font-bold text-stone-500">2/27</span>
                        <span class="font-bold text-stone-800">Day 3</span>
                    </button>
                    <button onclick="renderDailyPlan(4)" id="day-btn-4" class="day-selector flex flex-col items-center p-2 rounded-lg transition hover:bg-stone-100">
                        <span class="text-xs font-bold text-stone-500">2/28</span>
                        <span class="font-bold text-stone-800">Day 4</span>
                    </button>
                    <button onclick="renderDailyPlan(5)" id="day-btn-5" class="day-selector flex flex-col items-center p-2 rounded-lg transition hover:bg-stone-100">
                        <span class="text-xs font-bold text-stone-500">3/01</span>
                        <span class="font-bold text-stone-800">Day 5</span>
                    </button>
                </div>
            </div>

            <!-- Dynamic Itinerary Content -->
            <div id="daily-content" class="bg-white p-6 rounded-2xl shadow-sm border border-stone-100 min-h-[500px]">
                <!-- Javascript will populate this -->
            </div>
        </section>

        <!-- VIEW: LOGISTICS -->
        <section id="view-logistics" class="hidden space-y-6">
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-stone-100">
                <h2 class="text-xl font-bold mb-4 text-stone-800">🏨 住宿資訊 Accommodation</h2>
                <div class="space-y-4">
                    <!-- Day 1 Hotel -->
                    <div class="border-l-4 border-amber-500 pl-4 py-2 bg-stone-50 rounded-r-lg">
                        <div class="flex justify-between items-start">
                            <h3 class="font-bold text-lg">京阪京都 GRANDE 飯店 (2/25)</h3>
                            <span class="text-xs font-bold text-white bg-amber-500 px-2 py-1 rounded">Day 1</span>
                        </div>
                        <p class="text-sm text-stone-600 mb-2">Hotel Keihan Kyoto Grande</p>
                        <div class="flex items-center space-x-2 text-sm text-stone-500">
                            <span>📍 京都市南區東九條西山王町31</span>
                            <button onclick="copyToClipboard('京阪京都GRANDE飯店')" class="text-amber-600 underline text-xs">複製名稱</button>
                        </div>
                        <p class="text-sm mt-2 text-stone-500">🚅 位於京都車站八條口正對面</p>
                    </div>

                    <!-- Day 2 Ryokan -->
                    <div class="border-l-4 border-teal-600 pl-4 py-2 bg-stone-50 rounded-r-lg">
                        <div class="flex justify-between items-start">
                            <h3 class="font-bold text-lg">城崎溫泉 但馬屋 (2/26)</h3>
                            <span class="text-xs font-bold text-white bg-teal-600 px-2 py-1 rounded">Day 2</span>
                        </div>
                        <p class="text-sm text-stone-600 mb-2">Kinosaki Onsen Tajimaya (Ryokan)</p>
                        <div class="flex items-center space-x-2 text-sm text-stone-500">
                            <span>📍 兵庫縣豐岡市城崎町湯島453</span>
                            <button onclick="copyToClipboard('兵庫縣豐岡市城崎町湯島453')" class="text-amber-600 underline text-xs">複製地址</button>
                        </div>
                        <p class="text-sm mt-2">♨️ 包含一泊二食</p>
                    </div>

                    <!-- Day 3-4 Airbnb -->
                    <div class="border-l-4 border-indigo-500 pl-4 py-2 bg-stone-50 rounded-r-lg">
                        <div class="flex justify-between items-start">
                            <h3 class="font-bold text-lg">住一難波元町店 (2/27-2/28)</h3>
                            <span class="text-xs font-bold text-white bg-indigo-500 px-2 py-1 rounded">Day 3-4</span>
                        </div>
                        <p class="text-sm text-stone-600 mb-2">Apartment Hotel 11 Namba Motomachi</p>
                        <div class="flex items-center space-x-2 text-sm text-stone-500">
                            <span>📍 大阪府大阪市浪速区元町1丁目5-18</span>
                            <button onclick="copyToClipboard('大阪府大阪市浪速区元町1丁目5-18')" class="text-amber-600 underline text-xs">複製地址</button>
                        </div>
                        <p class="text-sm mt-2 text-red-500">⚠️ 請注意垃圾分類與夜間音量</p>
                    </div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-2xl shadow-sm border border-stone-100">
                <h2 class="text-xl font-bold mb-4 text-stone-800">✈️ 航班資訊 Flights</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="p-4 bg-sky-50 rounded-xl">
                        <span class="text-xs font-bold text-sky-700 bg-sky-200 px-2 py-1 rounded">去程 (2/25)</span>
                        <div class="mt-3 flex justify-between items-center">
                            <div class="text-center">
                                <div class="text-xl font-bold">TPE</div>
                                <div class="text-xs text-stone-500">07:00</div>
                            </div>
                            <div class="text-stone-400">✈️ IT 210</div>
                            <div class="text-center">
                                <div class="text-xl font-bold">KIX</div>
                                <div class="text-xs text-stone-500">10:25</div>
                            </div>
                        </div>
                    </div>
                    <div class="p-4 bg-orange-50 rounded-xl">
                        <span class="text-xs font-bold text-orange-700 bg-orange-200 px-2 py-1 rounded">回程 (3/01)</span>
                        <div class="mt-3 flex justify-between items-center">
                            <div class="text-center">
                                <div class="text-xl font-bold">KIX</div>
                                <div class="text-xs text-stone-500">18:55</div>
                            </div>
                            <div class="text-stone-400">✈️ IT 213</div>
                            <div class="text-center">
                                <div class="text-xl font-bold">TPE</div>
                                <div class="text-xs text-stone-500">21:10</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- VIEW: STATS & BUDGET & PACKING -->
        <section id="view-stats" class="hidden space-y-6">
            <!-- Cost Breakdown Table -->
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-stone-100">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4">
                    <h2 class="text-xl font-bold text-stone-800">💰 費用明細表 (7人)</h2>
                    <span class="text-xs bg-amber-100 text-amber-800 px-2 py-1 rounded mt-2 md:mt-0">幣別：新台幣 (TWD)</span>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left text-stone-600">
                        <thead class="text-xs text-stone-700 uppercase bg-stone-100">
                            <tr>
                                <th class="px-4 py-3 rounded-l-lg">項目 Item</th>
                                <th class="px-4 py-3">分類 Category</th>
                                <th class="px-4 py-3 text-right">總金額 Total</th>
                                <th class="px-4 py-3 text-right">平均/人 Avg</th>
                                <th class="px-4 py-3 rounded-r-lg">備註 Notes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="border-b border-stone-50 hover:bg-stone-50">
                                <td class="px-4 py-3 font-medium text-stone-900">✈️ 虎航機票</td>
                                <td class="px-4 py-3">
                                    <span class="bg-[#78716c] text-white px-2 py-1 rounded text-xs">機票 Flights</span>
                                </td>
                                <td class="px-4 py-3 text-right font-mono">117,914</td>
                                <td class="px-4 py-3 text-right font-mono text-amber-700">16,845</td>
                                <td class="px-4 py-3 text-xs text-stone-400">無餐點</td>
                            </tr>
                            <tr class="border-b border-stone-50 hover:bg-stone-50">
                                <td class="px-4 py-3 font-medium text-stone-900">🚐 台北包車 (單程)</td>
                                <td class="px-4 py-3">
                                    <span class="bg-[#3b82f6] text-white px-2 py-1 rounded text-xs">交通 Traffic</span>
                                </td>
                                <td class="px-4 py-3 text-right font-mono">1,600</td>
                                <td class="px-4 py-3 text-right font-mono text-amber-700">229</td>
                                <td class="px-4 py-3 text-xs text-stone-400">7人座接送</td>
                            </tr>
                            <tr class="border-b border-stone-50 hover:bg-stone-50">
                                <td class="px-4 py-3 font-medium text-stone-900">🚐 嘉義包車 (單程)</td>
                                <td class="px-4 py-3">
                                    <span class="bg-[#3b82f6] text-white px-2 py-1 rounded text-xs">交通 Traffic</span>
                                </td>
                                <td class="px-4 py-3 text-right font-mono">5,450</td>
                                <td class="px-4 py-3 text-right font-mono text-amber-700">779</td>
                                <td class="px-4 py-3 text-xs text-stone-400">9人座接送3人費用(爸/媽/昕樂)</td>
                            </tr>
                            <tr class="border-b border-stone-50 hover:bg-stone-50">
                                <td class="px-4 py-3 font-medium text-stone-900">🚄 JR關西廣域鐵路周遊券</td>
                                <td class="px-4 py-3">
                                    <span class="bg-[#3b82f6] text-white px-2 py-1 rounded text-xs">交通 Traffic</span>
                                </td>
                                <td class="px-4 py-3 text-right font-mono">14,635</td>
                                <td class="px-4 py-3 text-right font-mono text-amber-700">2,091</td>
                                <td class="px-4 py-3 text-xs text-stone-400">5大2小</td>
                            </tr>
                            <tr class="border-b border-stone-50 hover:bg-stone-50">
                                <td class="px-4 py-3 font-medium text-stone-900">🎢 環球影城門票 (4人)</td>
                                <td class="px-4 py-3">
                                    <span class="bg-[#ec4899] text-white px-2 py-1 rounded text-xs">娛樂 Fun</span>
                                </td>
                                <td class="px-4 py-3 text-right font-mono">5,840</td>
                                <td class="px-4 py-3 text-right font-mono text-amber-700">834</td>
                                <td class="px-4 py-3 text-xs text-stone-400">4人費用 (小蕙/正宇/姷宇/昕樂) | 匯率:0.2049</td>
                            </tr>
                            <tr class="border-b border-stone-50 hover:bg-stone-50">
                                <td class="px-4 py-3 font-medium text-stone-900">🎢 環球影城 VIP 3 (4人)</td>
                                <td class="px-4 py-3">
                                    <span class="bg-[#ec4899] text-white px-2 py-1 rounded text-xs">娛樂 Fun</span>
                                </td>
                                <td class="px-4 py-3 text-right font-mono">37,702</td>
                                <td class="px-4 py-3 text-right font-mono text-amber-700">5,386</td>
                                <td class="px-4 py-3 text-xs text-stone-400">4人費用 (小蕙/正宇/姷宇/昕樂) | 匯率:0.2049</td>
                            </tr>
                            <tr class="border-b border-stone-50 hover:bg-stone-50">
                                <td class="px-4 py-3 font-medium text-stone-900">📶 Nippon SIM (3G/日)</td>
                                <td class="px-4 py-3">
                                    <span class="bg-[#a855f7] text-white px-2 py-1 rounded text-xs">雜支 Misc</span>
                                </td>
                                <td class="px-4 py-3 text-right font-mono">750</td>
                                <td class="px-4 py-3 text-right font-mono text-amber-700">107</td>
                                <td class="px-4 py-3 text-xs text-stone-400">2張 (共用)</td>
                            </tr>
                            <tr class="border-b border-stone-50 hover:bg-stone-50">
                                <td class="px-4 py-3 font-medium text-stone-900">📶 環亞電訊網卡 (1G/日)</td>
                                <td class="px-4 py-3">
                                    <span class="bg-[#a855f7] text-white px-2 py-1 rounded text-xs">雜支 Misc</span>
                                </td>
                                <td class="px-4 py-3 text-right font-mono">466</td>
                                <td class="px-4 py-3 text-right font-mono text-amber-700">67</td>
                                <td class="px-4 py-3 text-xs text-stone-400">4張 (個人用)</td>
                            </tr>
                            <tr class="border-b border-stone-50 hover:bg-stone-50">
                                <td class="px-4 py-3 font-medium text-stone-900">🏨 京阪 GRANDE (Day 1)</td>
                                <td class="px-4 py-3">
                                    <span class="bg-[#d97706] text-white px-2 py-1 rounded text-xs">住宿 Hotel</span>
                                </td>
                                <td class="px-4 py-3 text-right font-mono">11,021</td>
                                <td class="px-4 py-3 text-right font-mono text-amber-700">1,574</td>
                                <td class="px-4 py-3 text-xs text-green-600 bg-green-50 rounded inline-block">含早餐</td>
                            </tr>
                            <tr class="border-b border-stone-50 hover:bg-stone-50">
                                <td class="px-4 py-3 font-medium text-stone-900">♨️ 但馬屋 (Day 2)</td>
                                <td class="px-4 py-3">
                                    <span class="bg-[#d97706] text-white px-2 py-1 rounded text-xs">住宿 Hotel</span>
                                </td>
                                <td class="px-4 py-3 text-right font-mono">39,675</td>
                                <td class="px-4 py-3 text-right font-mono text-amber-700">5,668</td>
                                <td class="px-4 py-3 text-xs text-green-600 bg-green-50 rounded inline-block">含早晚餐</td>
                            </tr>
                            <tr class="border-b border-stone-50 hover:bg-stone-50">
                                <td class="px-4 py-3 font-medium text-stone-900">🏠 AIRBNB (Day 3-4)</td>
                                <td class="px-4 py-3">
                                    <span class="bg-[#d97706] text-white px-2 py-1 rounded text-xs">住宿 Hotel</span>
                                </td>
                                <td class="px-4 py-3 text-right font-mono">14,429</td>
                                <td class="px-4 py-3 text-right font-mono text-amber-700">2,062</td>
                                <td class="px-4 py-3 text-xs text-stone-400">住2晚 (人均每晚約1031)</td>
                            </tr>
                        </tbody>
                        <tfoot class="font-bold text-stone-800 bg-amber-50">
                            <tr>
                                <td class="px-4 py-4 rounded-l-lg" colspan="2">總計 (目前已確認支出)</td>
                                <td class="px-4 py-4 text-right font-mono text-lg">249,482</td>
                                <td class="px-4 py-4 text-right font-mono text-lg text-amber-800">35,640</td>
                                <td class="px-4 py-4 rounded-r-lg text-xs font-normal text-stone-500">尚未包含當地交通與餐食</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Budget Chart -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-stone-100">
                    <h2 class="text-xl font-bold mb-4 text-stone-800">📊 預算分佈 (含預估)</h2>
                    <p class="text-sm text-stone-500 mb-4">圖表僅顯示已確認支出，尚未產生的費用（如餐飲、當地交通）皆列入剩餘預算。</p>
                    <div class="chart-container">
                        <canvas id="budgetChart"></canvas>
                    </div>
                </div>

                <!-- Packing List -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-stone-100">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-bold text-stone-800">🧳 行李清單</h2>
                        <span id="pack-progress" class="text-sm font-bold text-amber-600">0%</span>
                    </div>
                    <div class="space-y-2 h-[300px] overflow-y-auto pr-2" id="packing-list-container">
                        <!-- Items injected by JS -->
                    </div>
                </div>
            </div>

             <!-- Activity Level Chart -->
             <div class="bg-white p-6 rounded-2xl shadow-sm border border-stone-100">
                <h2 class="text-xl font-bold mb-4 text-stone-800">👣 每日體力消耗預估</h2>
                <p class="text-sm text-stone-500 mb-4">根據行程更新：Day 4 (環球影城/奈良宇治) 為體力大魔王，Day 1 (二条城+祇園) 與 Day 5 (大阪城) 步數亦高，請務必穿著舒適鞋履。</p>
                <div class="chart-container">
                    <canvas id="activityChart"></canvas>
                </div>
            </div>
        </section>

        <!-- VIEW: REGULATIONS (NEW) -->
        <section id="view-regulations" class="hidden space-y-6">
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-stone-100">
                <h2 class="text-2xl font-bold mb-6 text-stone-800 border-b pb-2">⚖️ 海關與攜帶物品法規 (2026 最新)</h2>
                
                <div class="grid gap-6">
                    <!-- Taiwan Outbound -->
                    <div class="regulation-card border-l-4 border-indigo-500">
                        <h3 class="regulation-title text-indigo-800">🇹🇼 台灣出境須知 (Taiwan Outbound)</h3>
                        <ul class="reg-list">
                            <li><span class="font-bold text-stone-800">現金限制：</span>新台幣 10 萬元、人民幣 2 萬元、外幣等值 1 萬美元 (超過需申報，未申報將沒入)。</li>
                            <li><span class="font-bold text-stone-800">鋰電池/行動電源：</span><span class="text-red-600 font-bold">必須隨身攜帶</span>，嚴禁託運。單顆額定能量不超過 160Wh。</li>
                            <li><span class="font-bold text-stone-800">液體 (手提)：</span>單瓶 < 100ml，需裝於 1 公升透明夾鏈袋。</li>
                            <li><span class="font-bold text-stone-800">打火機：</span>限隨身攜帶 1 個 (傳統型)，藍焰防風型禁止攜帶。</li>
                        </ul>
                    </div>

                    <!-- Japan Entry/Outbound -->
                    <div class="regulation-card border-l-4 border-teal-500">
                        <h3 class="regulation-title text-teal-800">🇯🇵 日本入境與出境 (Japan Entry/Exit)</h3>
                        <ul class="reg-list">
                            <li><span class="font-bold text-stone-800">Visit Japan Web：</span>請務必於出發前完成填寫，一人一碼 (可合併家人)。</li>
                            <li><span class="font-bold text-stone-800">現金限制：</span>攜帶超過 100 萬日圓 (或等值) 需申報。</li>
                            <li><span class="font-bold text-stone-800">免稅品 (Tax Free)：</span><span class="text-red-600 font-bold">消耗品 (藥妝/零食)</span> 專用封口袋<span class="text-red-600">離開日本前不可拆封</span>，否則補繳 10% 稅金。</li>
                            <li><span class="font-bold text-stone-800">禁止攜帶出境：</span>仿冒品、未打碼色情書刊。</li>
                            <li><span class="font-bold text-stone-800">溫泉禮儀：</span>入池前務必沖洗身體、毛巾不可入水、長髮請盤起。刺青者建議使用私人湯屋 (但馬屋貸切溫泉OK)。</li>
                            <li><span class="font-bold text-stone-800">電車禮儀：</span>車廂內請勿通話 (設為靜音)，且盡量避免飲食 (新幹線除外)。</li>
                        </ul>
                    </div>

                    <!-- Taiwan Inbound -->
                    <div class="regulation-card border-l-4 border-red-500 bg-red-50">
                        <h3 class="regulation-title text-red-800">🇹🇼 台灣入境須知 (Taiwan Inbound) ⚠️罰則極重</h3>
                        <ul class="reg-list">
                            <li><span class="font-bold text-stone-800">豬肉/肉製品：</span><span class="text-red-600 font-bold bg-white px-1 rounded">絕對禁止！</span>含火腿、培根、臘肉、肉鬆蛋捲、飛機餐沒吃完的肉。違者罰款 <span class="font-bold">20 萬元</span>起跳。</li>
                            <li><span class="font-bold text-stone-800">新鮮蔬果/植物：</span>所有新鮮水果 (如日本草莓/蘋果)、蔬菜、種子禁止入境。</li>
                            <li><span class="font-bold text-stone-800">電子菸/加熱菸：</span><span class="text-red-600 font-bold">全面禁止</span>攜帶入境 (含主機與煙彈)，違者最高罰 500 萬元。</li>
                            <li><span class="font-bold text-stone-800">藥妝限制 (自用)：</span>
                                <ul class="list-none ml-2 text-xs text-stone-600 mt-1">
                                    <li>• <span class="font-bold">非處方藥 (成藥)</span>：每種最多 12 瓶 (盒/罐)，合計以 36 瓶 (盒/罐) 為限。
                                        <div class="bg-amber-50 border border-amber-200 rounded p-2 mt-1 mb-1">
                                            <span class="font-bold text-amber-800">💡 計算範例：</span><br>
                                            新 LuLu 與大正感冒藥視為不同「種」，<span class="text-red-600 font-bold">分開計算</span> (各可帶 12 瓶)。<br>
                                            但所有藥品 (LuLu + 大正 + EVE + 合利他命...) 加總<span class="text-red-600 font-bold">不可超過 36 瓶</span>。
                                        </div>
                                        <span class="text-red-700 font-bold">★ 熱門限制清單：</span>EVE 止痛藥、大正百保能 (Pabron)、新 LuLu 感冒藥、合利他命、Wakamoto、太田胃散...等皆算在此額度內。
                                    </li>
                                    <li>• <span class="font-bold">隱形眼鏡</span>：單一度數 60 片，每人限 1 種度數。</li>
                                    <li>• <span class="font-bold">醫療器材</span>：如<span class="font-bold">液體 OK 繃</span>、醫用口罩、體溫計，原則上每種限帶 1 個 (自用合理數量內海關通常會放行，但勿大量囤貨)。</li>
                                </ul>
                            </li>
                            <li><span class="font-bold text-stone-800">個人自用藥物：</span>若攜帶處方藥，建議保留藥袋或處方箋影本以備查驗。</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-stone-100 py-6 mt-8">
        <div class="max-w-5xl mx-auto px-4 text-center text-stone-500 text-sm">
            <p>2026 蕭家旅行專屬 App • Designed for Family</p>
        </div>
    </footer>

    <script>
        // --- DATA STORE ---
        // Simulating data derived from the source report
        const itineraryData = {
            1: {
                title: "抵達京都 & 自由活動",
                focus: "移動/彈性",
                weather: "☁️ 6°C (夜 0~1°C)",
                events: [
                    { time: "04:00", title: "包車出發：台北民生社區", icon: "🚐", desc: "商務大車接送 (預計 04:50 抵達)。<br>📍 上車：臺北市松山區新中街13-2號<br>📍 下車：桃園機場第一航廈 T1<br>👥 人數：7大 | 🧳 行李：28吋x5, 18吋x3<br>💰 付款：$1600 現金" },
                    { time: "07:00", title: "桃園機場出發 (TPE)", icon: "✈️", desc: "虎航 IT210, 第一航廈7號櫃檯報到。務必在 <span class='text-red-600 font-bold'>05:30 前</span>完成報到與行李託運。" },
                    { time: "10:25", title: "抵達關西機場 (KIX)", icon: "🛬", desc: "領取行李。<br><span class='text-amber-700 font-bold'>💡 貼心提醒：兌換車票前，請先在附近超商或餐廳購買輕食果腹，避免因搭車錯過午餐。</span><br>前往 JR 綠色窗口兌換車票。<br>🚶 前往方式：搭乘手扶梯上2樓走空橋去關西機場車站。<br>📝 辦理事項：<br>1. 兌換關西廣域鐵路周遊券<br>2. 領票 HARUKA 22到京都<br>3. 領票 2/26 Kinosaki 5 (11:25)<br>4. 領票 2/27 Kounotori 18 (13:29)<br>5. 購買 ICOCA 卡" },
                    { time: "12:14", title: "搭乘 Haruka 特急", icon: "🚆", desc: "Haruka 22號 (往京都)，預計 13:34 抵達京都車站。<br>📍 入站：從 <span class='font-bold'>B GATE</span> 走進去。<br>👀 排隊：依照地上<span class='text-sky-600 font-bold'>淺藍色 HARUKA 車廂位置貼紙</span>排隊。<br>⚠️ <span class='text-red-600 font-bold'>車票保管：</span>出站需使用，請勿遺失。<br>⚠️ <span class='text-red-600 font-bold'>車廂確認：</span>座位為 4 號車 12A/12B/12C/12D/11A/11B/11C" },
                    { time: "14:00", title: "飯店 Check-in / 寄放行李", icon: "🏨", desc: "京阪京都 GRANDE 飯店 (京都車站八條口)。<br>🚶 前往方式：京都車站地下通路，依著『AVANTI』大樓方向，左手邊就可看到ホテル京阪入口，經過一段不算長的美食商店街，搭電梯到二樓，就可到櫃台辦理入住手續。" },
                    { time: "15:00", title: "前往二条城", icon: "🏯", desc: "世界遺產元離宮二条城。<br>⏰ <span class='text-red-600 font-bold'>最後入場時間：16:00</span> (17:00 閉城)。<br>⚠️ <span class='text-red-600 font-bold'>重要提醒：</span>入內參觀二之丸御殿需脫鞋，木頭地板極冷，請長輩務必穿著保暖厚襪子。<br>💡 備案提醒：若時間不足或成員太累，請直接放棄此行程，改為在京都車站內商場/伊勢丹百貨及京都塔周邊散步逛街。" },
                    { time: "17:00", title: "前往京都祇園", icon: "🏮", desc: "漫步花見小路與八坂神社。<br>🚌 交通建議：<br>1. 🏯 <span class='font-bold text-stone-700'>從二条城</span>：<br>• 地鐵：東西線「二条城前」→「三条京阪」，步行過鴨川即達。<br>• 計程車：約 15-20 分鐘。<br>2. 🚉 <span class='font-bold text-stone-700'>從京都車站</span>：<br>• 巴士：中央口 D2 月台搭乘 206/86 號至「祇園」下車。<br>• 計程車：約 15 分鐘 (車資約 ¥1500-2000)。" },
                    { time: "18:00", title: "晚餐：京都祇園 鰻魚四代目菊川", icon: "🍱", desc: "享用知名一本鰻。<br><a href='https://www.google.com/maps/place/%E4%BA%AC%E9%83%BD%E7%A5%87%E5%9C%92+%E9%B0%BB%E9%AD%9A%E5%9B%9B%E4%BB%A3%E7%9B%AE%E8%8F%8A%E5%B7%9D/@35.0057498,135.7732449,21z/data=!4m14!1m7!3m6!1s0x60010925112089e5:0x561d8d58111603c8!2z5Lqs6YO956WH5ZySIOmwu-mtmuWbm-S7o-ebruiPiuW3nQ!8m2!3d35.0057627!4d135.7733978!16s%2Fg%2F11v4m7yq71!3m5!1s0x60010925112089e5:0x561d8d58111603c8!8m2!3d35.0057627!4d135.7733978!16s%2Fg%2F11v4m7yq71?entry=ttu&g_ep=EgoyMDI2MDEyNy4wIKXMDSoASAFQAw%3D%3D' target='_blank' class='text-amber-600 underline font-bold'>📍 點此開啟 Google Maps 導航</a>" },
                    { time: "19:30", title: "夜遊八坂神社 & 散步回程", icon: "⛩️", desc: "參拜八坂神社 (24H 開放)，欣賞舞殿燈籠夜景。<br>⚠️ <span class='text-amber-700 font-bold'>市集/攤販：通常約 21:00 結束營業。</span><br>⚠️ <span class='text-red-600 font-bold'>周邊注意：</span>花見小路部分私道「禁止拍照」，違者恐受罰，請留意路邊告示牌。<br><br><span class='font-bold text-indigo-700'>🚶 散步路線建議：</span><br><div class='mt-1 space-y-2'><div class='bg-stone-100 p-2 rounded'><span class='font-bold text-stone-800'>⭐ 路線 A（最輕鬆）</span><br>八坂神社 → 花見小路 → 四条河原町<br><span class='text-xs text-stone-500'>• 特色：平路、夜景好、隨時可搭車回京都站</span></div><div class='bg-stone-100 p-2 rounded'><span class='font-bold text-stone-800'>⭐ 路線 B（氣氛感）</span><br>八坂神社 → 祇園白川<br><span class='text-xs text-stone-500'>• 特色：傳統街景、晚上安靜、拍照漂亮<br>⚠️ 路稍暗，走慢即可</span></div>" }
                ]
            },
            2: {
                title: "移動日：前往城崎溫泉",
                focus: "溫泉/松葉蟹",
                weather: "🌨️ 4~8°C (恐有雪)",
                events: [
                    { time: "08:00", title: "飯店早餐", icon: "🍳", desc: "享用京阪京都 GRANDE 飯店早餐。" },
                    { time: "10:30", title: "選購便當：駅弁旅弁当 京都3号店", icon: "🍱", desc: "營業時間 07:00-21:30。位於 JR 改札口內。請由飯店走至中央口入站後購買，隨後前往31號月台。" },
                    { time: "11:25", title: "京都站出發", icon: "🚆", desc: "搭乘 Kinosaki 5 (城崎號)，31號月台發車 (約2小時24分)。<br>⚠️ <span class='text-red-600 font-bold'>車上飲食：</span>通常無車內販售，請務必先買好便當/飲料。<br>⚠️ <span class='text-red-600 font-bold'>車廂確認：</span>座位為 5 號車 14A/14B/14C/14D/13A/13B/13C" },
                    { time: "13:49", title: "抵達城崎溫泉", icon: "♨️", desc: "車站寄放行李，溫泉街散策、享用午餐/點心。<br>🍮 <span class='font-bold'>推薦名產：</span>たまご専門本巣ヱ (雞蛋麵包)<br>⏰ 営業時間：10:00～18:00<br><a href='https://motosue.lbb-r.com/store/detail/?store_id=12979' target='_blank' class='text-amber-600 underline font-bold'>👉 點此線上訂購 (預約避免排隊)</a>" },
                    { time: "15:00", title: "旅館 Check-in", icon: "👘", desc: "入住：但馬屋 (Tajimaya)。換穿浴衣。<br>⚠️ <span class='text-red-600 font-bold'>重要：</span>Check-in 時請務必與旅館確認晚餐時間，切勿遲到以免無法用餐。" },
                    { time: "16:00", title: "七外湯巡禮", icon: "🧖", desc: "憑通票享受溫泉街氣氛。<br><img src='https://drive.google.com/thumbnail?id=11qdBocIhm9iZs-6ABroIOjzlbu19wlK9&sz=w1000' alt='七外湯地圖' class='w-full rounded-lg mt-2 mb-1 shadow-sm border border-stone-200'><a href='https://drive.google.com/file/d/11qdBocIhm9iZs-6ABroIOjzlbu19wlK9/view?usp=sharing' target='_blank' class='text-xs text-amber-600 underline block mb-2'>📍 若圖片無法顯示，請點此開啟原圖</a>📍 <span class='font-bold text-stone-700'>位置筆記：</span>但馬屋位於溫泉街中心，距離<span class='text-amber-700 font-bold'>【御所之湯】</span>與<span class='text-amber-700 font-bold'>【一之湯】</span>最近。<br><br><div class='bg-stone-100 p-3 rounded-lg border border-stone-200 text-sm'><span class='font-bold text-stone-800'>♨️ 外湯營業時間 (請留意公休日)：</span><ul class='list-disc pl-4 mt-1 space-y-1 text-xs text-stone-600'><li><span class='font-bold'>里之湯</span> 13:00–21:00 <span class='text-red-600 font-bold'>⚠️長期休業中</span></li><li><span class='font-bold'>地藏湯</span> 07:00–23:00 (週五休) 被視為家庭安全之湯</li><li><span class='font-bold'>柳湯</span> 15:00–23:00 (週三休) 最小最傳統的浴池，據說可保佑生育</li><li><span class='font-bold'>一之湯</span> 07:00–23:00 (週三休) 外型仿歌舞伎座，有洞穴浴池，人氣高</li><li class='text-red-600 font-bold bg-red-50 rounded px-1'>御所之湯 07:00–23:00 (週四休) ⚠️今日公休 參考京都御所設計，有自然瀑布，被視為美人湯、愛情運之湯</li><li><span class='font-bold'>曼荼羅湯</span> 15:00–23:00 (週三休) 有陶瓷露天浴池，山景宜人，空間小建議跳過</li><li><span class='font-bold'>鴻之湯</span> 07:00–23:00 (週二休) 最古老，有白鶴療傷傳說，保佑姻緣長壽</li></ul></div><p class='mt-2 text-red-600 font-bold text-xs'>⚠️ 御所之湯今日休息，請改至明日(2/27)上午前往。</p>" },
                    { time: "18:00", title: "晚餐：松葉蟹大餐", icon: "🦀", desc: "旅館內享用會席料理。" },
                    { time: "20:00", title: "休息", icon: "💤", desc: "宿：但馬屋。夜間氣溫約 -1~1°C。<br><br><span class='font-bold text-teal-700'>♨️ 旅館內免費貸切溫泉 (不想外出可泡)</span><br>但馬屋有3個特色私人湯屋：<br>1. <span class='font-bold'>花玄の湯</span>：用燈籠營造出光影變化<br>2. <span class='font-bold'>竹葉の湯</span>：榻榻米和用竹子裝飾的浴池<br>3. <span class='font-bold'>きららの湯</span>：露天風呂<br>⏰ 6:00〜24:00 (一次約使用45分鐘/無限次)<br>🔑 <span class='font-bold'>使用方式：</span>請至櫃檯確認空位，用房間鑰匙換取貸切溫泉鑰匙。" }
                ]
            },
            3: {
                title: "移動回大阪 (梅田轉乘)",
                focus: "移動/入住Airbnb",
                weather: "🌤️ 9°C (夜 2°C)",
                events: [
                    { time: "08:00", title: "旅館早餐", icon: "🍱", desc: "享用但馬屋精緻日式早膳。" },
                    { time: "10:00", title: "Check-out & 補泡御所之湯", icon: "♨️", desc: "把握最後時間前往<span class='font-bold text-amber-700'>【御所之湯】</span>(昨日公休)，或逛溫泉街、買伴手禮。<br>⚠️ <span class='text-red-600 font-bold'>退房提醒：</span>請確認隨身物品，特別是護照與周遊券。" },
                    { time: "12:00", title: "午餐：城崎溫泉", icon: "🍴", desc: "簡單享用海鮮丼或但馬牛漢堡。" },
                    { time: "13:29", title: "城崎溫泉站出發", icon: "🚆", desc: "搭乘 Kounotori 18 (東方白鸛號)。<br>建議提早 15 分鐘到月台候車。<br>⚠️ <span class='text-red-600 font-bold'>車廂確認：</span>座位為 6 號車 1A/1B/1C/1D/2B/2C/2D" },
                    { time: "16:23", title: "抵達 JR 大阪站 (梅田)", icon: "📍", desc: "於梅田地區轉乘地鐵御堂筋線前往難波。<br>⚠️ <span class='text-red-600 font-bold'>人潮注意：</span>梅田站結構複雜且人潮眾多，請緊跟指標往「御堂筋線」移動。" },
                    { time: "17:15", title: "住一難波元町店 Check-in", icon: "🏠", desc: "從難波站步行/搭計程車前往 Airbnb 入住。<br>⚠️ <span class='text-red-600 font-bold'>入住須知：</span>請備妥入住代碼/鑰匙密碼，並保持安靜 (日本民宿對噪音非常敏感)。" },
                    { time: "18:30", title: "晚餐：難波/道頓堀", icon: "🍜", desc: "放下行李後，於附近享用晚餐。" },
                    { time: "21:00", title: "宵夜：福太郎大阪燒", icon: "🥘", desc: "大阪燒名店 (本店)。營業時間：17:00-00:30。<br><a href='https://www.ubereats.com/jp/store/%E7%A6%8F%E5%A4%AA%E9%83%8E%E6%9C%AC%E5%BA%97-fukutaro/bH99ZpmVVwKkpQErdr9Nqg?diningMode=PICKUP&utm_campaign=CM2508147-search-free-nonbrand-google-pas_e_all_acq_Global&utm_medium=search-free-nonbrand&utm_source=google-pas' target='_blank' class='text-amber-600 underline font-bold'>Uber Eats 菜單/預訂</a>" }
                ]
            },
            4: {
                title: "分組行動日：USJ vs 奈良宇治",
                focus: "樂園/古蹟",
                weather: "☀️ 10°C (夜 3°C)",
                // Data structure adjusted for split view logic in renderer
                splitEvents: {
                    kids: [
                        { time: "06:00", title: "出發前往 USJ", icon: "🎢", desc: "搭乘電車前往，主攻馬利歐/哈利波特 (全日)。<br><br><span class='font-bold text-indigo-700'>⭐ 建議路線 1 (JR為主｜周遊券可用)</span><br>住宿 🚶 (8-10分) → JR 難波站<br>→ JR 大和路線 (3分) → 今宮站<br>→ 大阪環狀線 (10分) → 西九條站<br>→ JR 夢咲線 (5分) → 環球城站<br>⏱️ 總時程：約 35-40 分 (轉乘2次)<br>✅ 優點：全程 JR 免額外付費<br><br><span class='font-bold text-stone-700'>⭐ 建議路線 2 (南海＋JR)</span><br>住宿 🚶 (10-12分) → 南海難波站<br>→ 南海本線 (3分) → 新今宮站<br>→ JR 大阪環狀線 (10分) → 西九條站<br>→ JR 夢咲線 (5分) → 環球城站<br>⏱️ 總時程：約 40-45 分 (轉乘2次)<br>⚠️ 備註：南海段需自費，其餘 JR 段可用周遊券<br><br>⚠️ <span class='text-red-600 font-bold'>入園須知：</span><br>1. 禁止攜帶外食 (入口會檢查包包)<br>2. 務必提前下載 USJ App 並登錄門票以便抽取整理券。" },
                        { time: "12:00", title: "園區午餐", icon: "🍔", desc: "三根掃帚或奇諾比奧餐廳。<br>⚠️ <span class='text-red-600 font-bold'>人潮提醒：</span>用餐時間人潮極多，建議提早或延後用餐。" },
                        { time: "18:00", title: "晚餐：CityWalk", icon: "🍜", desc: "影城外商店街用餐，購買紀念品。" }
                    ],
                    elders: [
                        { time: "08:00-12:30", title: "早安奈良：東大寺與小鹿", icon: "🦌", desc: "🌅 <span class='font-bold text-amber-700'>早上｜難波 → 奈良 (東大寺)</span><br>• 08:00｜從住宿地出發 (步行至 JR 難波)<br>• 08:15｜<span class='font-bold'>JR 難波出發</span> (大和路快速/周遊券可用)<br>• 09:05｜抵達 JR 奈良站<br>• 09:15｜轉乘巴士 (往東大寺)：<br>&nbsp;&nbsp;📍 <span class='text-indigo-700 font-bold'>JR 奈良站「東口 2 號乘車處」</span><br>&nbsp;&nbsp;🚌 搭乘：<span class='font-bold'>2 號系統 (市內循環-外回)</span>、77、97 號<br>&nbsp;&nbsp;🛑 下車：東大寺大佛殿・春日大社前<br>• 09:30｜<span class='font-bold'>東大寺大佛殿 & 奈良公園</span><br>⚠️ <span class='text-red-600 font-bold'>小鹿警報：</span>鹿群若看到仙貝會非常積極(甚至咬人)，請注意自身安全與隨身物品。<br>• 11:00｜搭公車回 JR 奈良站：<br>&nbsp;&nbsp;🚌 搭乘：<span class='font-bold'>1 號系統 (市內循環-內回)</span>、77、97 號<br>&nbsp;&nbsp;🛑 下車：JR 奈良站 (約 10-15 分鐘)<br>• 11:30｜<span class='font-bold'>午餐</span>：JR 奈良站周邊 (選擇多、動線平)" },
                        { time: "12:45-14:15", title: "順遊宇治 (彈性行程)", icon: "🍵", desc: "🍵 <span class='font-bold text-green-700'>中午｜奈良 → 宇治 (加行程關鍵段)</span><br>⚠️ <span class='text-red-600 font-bold'>體力注意：若體力不足則忽略此景點，直接前往伏見稻荷。</span><br>• 12:45｜JR 奈良出發 (JR 奈良線/周遊券可用)<br>• 13:15｜抵達宇治站<br>• 13:15-14:15｜<span class='font-bold'>宇治輕量行程 (約 1 小時)</span><br>&nbsp;&nbsp;📸 平等院外觀拍照 (不一定入內)<br>&nbsp;&nbsp;🚶 宇治川河畔散步<br>&nbsp;&nbsp;🍦 抹茶甜點／茶屋坐著休息<br>✅ 這一段是「加分但不累」<br>✅ 若臨時覺得累，可提早離開" },
                        { time: "14:30-16:00", title: "伏見稻荷大社 (千本鳥居)", icon: "⛩️", desc: "⛩ <span class='font-bold text-red-700'>下午｜宇治 → 伏見稻荷</span><br>• 14:30｜宇治出發 (JR 奈良線往京都方向)<br>• 14:45｜抵達稻荷站 (出站即達)<br>• 14:45-16:00｜<span class='font-bold'>伏見稻荷大社</span><br>&nbsp;&nbsp;👏 入口參拜<br>&nbsp;&nbsp;📸 前段千本鳥居拍照<br>&nbsp;&nbsp;❌ <span class='text-red-600 font-bold'>不爬完整稻荷山 (保留體力)</span>" },
                        { time: "16:10", title: "返回大阪難波", icon: "🚆", desc: "🌆 <span class='font-bold text-stone-700'>傍晚｜伏見稻荷 → 難波 (回程)</span><br>• 16:10｜稻荷站出發 (全 JR / 周遊券可用)<br>&nbsp;&nbsp;🔄 路線：稻荷 → (5分) 京都 → (新快速30分) 大阪 → (環狀線10分) JR 難波<br>⚠️ <span class='text-red-600 font-bold'>下班尖峰：</span>此時段電車可能較擁擠，請長輩留意腳步。<br>• 17:20-17:40｜抵達 JR 難波<br>• 18:00｜<span class='font-bold'>難波晚餐</span> 或直接回住宿休息" }
                    ],
                    common: [
                        { time: "20:00", title: "全員民宿會合", icon: "🏠", desc: "分享今日照片與戰利品。宿：住一難波元町店。" }
                    ]
                }
            },
            5: {
                title: "大阪城 & 返程",
                focus: "觀光/購物/返程",
                weather: "🌤️ 10°C (夜 3°C)",
                events: [
                    { time: "08:00-11:30", title: "大阪城", icon: "🏯", desc: "行李寄放飯店或寄物櫃 (建議「只留隨身小包」)<br>⚠️ <span class='text-red-600 font-bold'>寄物提醒：</span>大型行李寄物櫃易客滿，若找不到空位，請改至 JR 車站的人工寄物處。<br>• 08:30｜從住宿地出發 → 前往大阪城公園<br>• 09:15-09:30｜抵達大阪城<br>&nbsp;&nbsp;🚉 建議下車站：<span class='font-bold'>森之宮站</span> (電梯多、動線平) 或 <span class='font-bold'>大阪城公園站</span> (離天守近)<br>• 09:30-11:30｜<span class='font-bold'>大阪城活動</span><br>&nbsp;&nbsp;📸 天守外觀拍照<br>&nbsp;&nbsp;⏱️ 若要上天守：控制 60 分鐘內<br>&nbsp;&nbsp;🚶 公園散步 (平坦、不累)<br>📌 <span class='text-red-600 font-bold'>原則：11:30 一定離開大阪城</span>" },
                    { time: "11:30-13:30", title: "回市區用餐＋取行李", icon: "🍴", desc: "建議回：難波 或 梅田<br>• 12:30–13:30｜<span class='font-bold'>午餐</span><br>&nbsp;&nbsp;❌ 不排名店<br>&nbsp;&nbsp;🧳 吃完直接取行李" },
                    { time: "14:30", title: "前往關西機場", icon: "🚆", desc: "🚉 <span class='font-bold'>建議交通</span>：<br>&nbsp;&nbsp;• 南海電鐵 (難波 → KIX)<br>&nbsp;&nbsp;• JR HARUKA (梅田／天王寺 → KIX)<br><br><span class='font-bold text-indigo-700'>🔄 天王寺轉乘攻略 (JR 難波出發)：</span><br>1. JR 難波抵達天王寺：停靠 1~2 號月台 (地面)<br>2. 轉乘移動：前往中央口 → 搭電扶梯/電梯上樓<br>3. <span class='font-bold'>搭乘 HARUKA：</span>前往 <span class='text-amber-600 font-bold'>16/17 號月台</span> (高架)<br>4. <span class='font-bold'>搭乘關空快速：</span>前往 <span class='text-amber-600 font-bold'>15/18 號月台</span> (高架)<br>&nbsp;&nbsp;⚠️ 關空快速雖班次多，但車廂擠且不適合大行李。<br><br>💡 <span class='font-bold bg-amber-100 text-amber-800 px-1 rounded'>懶人記法</span>：<br>JR 難波下車 → 天王寺 → 中央口 → 上樓 → 16/17 (Haruka) 或 15/18 (關空快速)<br><br>• 16:00–16:30｜抵達關西機場<br>&nbsp;&nbsp;📝 報到、托運、出境<br>&nbsp;&nbsp;🛍️ 還有時間吃東西、買伴手禮<br>⚠️ <span class='text-red-600 font-bold'>15:00 前一定離開市區 (很重要)</span>" },
                    { time: "16:55", title: "關西機場報到", icon: "✈️", desc: "虎航 IT213 櫃台報到。" },
                    { time: "18:55", title: "起飛返台", icon: "🏠", desc: "預計 21:10 抵達桃園機場 (TPE)。" },
                    { time: "22:00", title: "【嘉義組】和運包車返家", icon: "🚐", desc: "預約編號：X036-W15C01256<br>⏰ 預約出發：2026/03/01 21:20 (依航班實際抵達接送)<br>📍 出發地點：桃園機場<br>📍 到達地點：625嘉義縣布袋鎮太平東路470號<br>🚐 預約車型：廂型車" }
                ]
            }
        };

        const packingList = {
            carryOn: [
                { name: "護照 (有效期6個月以上)", icon: "🛂" },
                { name: "身份證/健保卡", icon: "🆔" },
                { name: "日幣現金 & 信用卡", icon: "💴" },
                { name: "Visit Japan Web截圖", icon: "📲" },
                { name: "網卡/漫遊開通", icon: "📶" },
                { name: "個人常備藥品", icon: "💊" },
                { name: "行動電源（100Wh以下） & 充電線", icon: "🔋" },
                { name: "手機", icon: "📱" },
                { name: "耳機 (若有帶的話)", icon: "🎧" },
                { name: "行李秤", icon: "⚖️" },
                { name: "真空壓縮器", icon: "🌬️" },
                { name: "口罩", icon: "😷" },
                { name: "蒸氣眼罩 (非必要)", icon: "😴" },
                { name: "太陽眼鏡", icon: "🕶️" }
            ],
            checked: [
                { name: "上衣、褲子、內衣褲、襪子", icon: "👕" },
                { name: "厚外套/羽絨衣、圍巾、手套、發熱衣", icon: "🧥" },
                { name: "好走的鞋子", icon: "👟" },
                { name: "環球影城門票 QR Code", icon: "🎟️" },
                { name: "壓縮袋", icon: "🛍️" },
                { name: "暖暖包", icon: "🔥" },
                { name: "家鑰匙/車鑰匙", icon: "🔑" },
                { name: "夾鍊袋數個", icon: "👝" }
            ]
        };

        // --- CHART CONFIG ---
        function initCharts() {
            // Register DataLabels Plugin
            Chart.register(ChartDataLabels);

            // Weather Chart - UPDATED to show High/Low Temps
            const ctxWeather = document.getElementById('weatherChart').getContext('2d');
            new Chart(ctxWeather, {
                type: 'line',
                data: {
                    labels: ['2/25 (京都)', '2/26 (城崎)', '2/27 (大阪)', '2/28 (大阪)', '3/1 (大阪)'],
                    datasets: [
                        {
                            label: '最高溫 (°C)',
                            // TODO: 出發前請更新此處數值 (依序為 Day1 -> Day5)
                            data: [8, 6, 9, 10, 11], 
                            borderColor: '#ef4444', // red-500
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            tension: 0.3,
                            pointBackgroundColor: '#fff',
                            pointBorderColor: '#ef4444',
                            pointRadius: 5
                        },
                        {
                            label: '最低溫 (°C)',
                            // TODO: 出發前請更新此處數值 (依序為 Day1 -> Day5)
                            data: [1, 0, 2, 3, 4], 
                            borderColor: '#3b82f6', // blue-500
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.3,
                            pointBackgroundColor: '#fff',
                            pointBorderColor: '#3b82f6',
                            pointRadius: 5
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            display: true, // Show legend to distinguish High/Low
                            position: 'top',
                            labels: { usePointStyle: true }
                        },
                        datalabels: { 
                            display: true, // Show numbers on chart
                            align: 'top',
                            color: '#666',
                            font: { size: 10 }
                        } 
                    },
                    scales: {
                        y: { 
                            beginAtZero: false, 
                            suggestedMin: -2, // Allow for negative temps in Kinosaki
                            suggestedMax: 15 
                        }
                    }
                }
            });

            // Budget Chart - UPDATED WITH REAL DATA & BUDGET CAP
            const ctxBudget = document.getElementById('budgetChart').getContext('2d');
            
            // Register a custom plugin to draw text in the center
            const centerTextPlugin = {
                id: 'centerText',
                beforeDraw: function(chart) {
                    if (!chart.chartArea) return;
                    var ctx = chart.ctx;
                    var chartArea = chart.chartArea;
                    var centerX = (chartArea.left + chartArea.right) / 2;
                    var centerY = (chartArea.top + chartArea.bottom) / 2;
            
                    ctx.restore();
                    var height = chartArea.bottom - chartArea.top;
                    // Slightly reduce font size to fit the smaller hole nicely
                    var fontSize = (height / 200).toFixed(2);
                    
                    ctx.font = "bold " + fontSize + "em sans-serif";
                    ctx.textBaseline = "middle";
                    ctx.textAlign = "center";
                    ctx.fillStyle = "#78350f"; 
            
                    ctx.fillText("總預算", centerX, centerY - 10);
                    ctx.fillText("35萬", centerX, centerY + 10);
                    ctx.save();
                }
            };

            new Chart(ctxBudget, {
                type: 'doughnut',
                data: {
                    labels: ['機票 Flights', '住宿 Hotel', '交通 Traffic', '娛樂 Fun', '雜支 Misc', '剩餘預算 Remaining'],
                    datasets: [{
                        data: [117914, 65125, 21685, 43542, 1216, 100518], 
                        backgroundColor: [
                            '#78716c', // Flights
                            '#d97706', // Hotel
                            '#3b82f6', // Traffic
                            '#ec4899', // Fun
                            '#a855f7', // Misc
                            '#10b981'  // Remaining
                        ],
                        borderWidth: 1,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '40%', // Reduced from 60% to 40% to maximize visible area
                    layout: {
                        padding: 20
                    },
                    plugins: {
                        legend: { position: 'right', display: false }, // Hide legend to let datalabels shine? Or keep it? User said "visual". Let's keep legend but add datalabels.
                        datalabels: {
                            color: '#fff', // White for all now that colors are dark enough
                            font: {
                                weight: 'bold',
                                size: 11
                            },
                            formatter: function(value, context) {
                                let label = context.chart.data.labels[context.dataIndex];
                                // Shorten labels for chart display
                                let shortLabel = label.split(' ')[0]; 
                                let total = 350000;
                                let percentage = Math.round((value / total) * 100) + '%';
                                let valInK = Math.round(value / 1000) + 'k';
                                return shortLabel + '\n$' + valInK + '\n(' + percentage + ')';
                            },
                            textAlign: 'center',
                            offset: 0,
                            anchor: 'center',
                            align: 'center'
                        }
                    }
                },
                plugins: [centerTextPlugin]
            });

            // Activity Chart
            const ctxActivity = document.getElementById('activityChart').getContext('2d');
            new Chart(ctxActivity, {
                type: 'bar',
                data: {
                    labels: ['Day 1 (京都)', 'Day 2 (城崎)', 'Day 3 (大阪)', 'Day 4 (USJ/奈良)', 'Day 5 (大阪城)'],
                    datasets: [{
                        label: '預估步數',
                        data: [14000, 10000, 12000, 22000, 15000],
                        backgroundColor: (ctx) => {
                            const val = ctx.raw;
                            return val > 15000 ? '#ef4444' : '#d97706'; 
                        },
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        datalabels: { 
                            display: true,
                            color: '#666',
                            anchor: 'end',
                            align: 'top',
                            formatter: Math.round
                        } 
                    },
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        }

        // --- CORE LOGIC ---

        function switchTab(tabId) {
            // Hide all views
            ['overview', 'itinerary', 'logistics', 'stats', 'regulations'].forEach(id => {
                document.getElementById(`view-${id}`).classList.add('hidden');
                document.getElementById(`nav-${id}`).classList.remove('tab-active', 'text-amber-900', 'font-bold');
                document.getElementById(`nav-${id}`).classList.add('text-stone-500');
            });

            // Show selected view
            document.getElementById(`view-${tabId}`).classList.remove('hidden');
            document.getElementById(`nav-${tabId}`).classList.add('tab-active');
            document.getElementById(`nav-${tabId}`).classList.remove('text-stone-500');

            // Force Chart resize if charts become visible
            if (tabId === 'overview' || tabId === 'stats') {
                window.dispatchEvent(new Event('resize'));
            }
        }

        function renderDailyPlan(day) {
            // Update buttons
            document.querySelectorAll('.day-selector').forEach(btn => {
                btn.classList.remove('bg-amber-100', 'ring-2', 'ring-amber-400');
            });
            document.getElementById(`day-btn-${day}`).classList.add('bg-amber-100', 'ring-2', 'ring-amber-400');

            const data = itineraryData[day];
            const container = document.getElementById('daily-content');
            
            // Render Header
            let contentHtml = `
                <div class="animate-fade-in">
                    <div class="flex justify-between items-end mb-6 border-b border-stone-100 pb-4">
                        <div>
                            <h2 class="text-2xl font-bold text-stone-800">Day ${day}：${data.title}</h2>
                            <div class="flex gap-3 mt-2">
                                <span class="text-xs font-semibold bg-stone-200 text-stone-600 px-2 py-1 rounded">重點：${data.focus}</span>
                                <span class="text-xs font-semibold bg-blue-50 text-blue-600 px-2 py-1 rounded">天氣：${data.weather}</span>
                            </div>
                        </div>
                    </div>
            `;

            // Special Split Render for Day 4
            if (day === 4 && data.splitEvents) {
                // Generate Kids Column
                let kidsHtml = data.splitEvents.kids.map(event => `
                    <div class="mb-4 bg-amber-50 p-3 rounded-lg border border-amber-100">
                        <div class="flex items-center gap-2 mb-1">
                            <span class="text-xl">${event.icon}</span>
                            <span class="font-bold text-amber-800 text-sm">${event.time}</span>
                        </div>
                        <div class="font-bold text-stone-800 text-sm mb-1">${event.title}</div>
                        <p class="text-xs text-stone-500">${event.desc}</p>
                    </div>
                `).join('');

                // Generate Elders Column
                let eldersHtml = data.splitEvents.elders.map(event => `
                    <div class="mb-4 bg-stone-50 p-3 rounded-lg border border-stone-200">
                        <div class="flex items-center gap-2 mb-1">
                            <span class="text-xl">${event.icon}</span>
                            <span class="font-bold text-stone-600 text-sm">${event.time}</span>
                        </div>
                        <div class="font-bold text-stone-800 text-sm mb-1">${event.title}</div>
                        <p class="text-xs text-stone-500">${event.desc}</p>
                    </div>
                `).join('');

                 // Generate Common Column
                 let commonHtml = data.splitEvents.common.map(event => `
                    <div class="mt-4 bg-indigo-50 p-4 rounded-xl border border-indigo-100 flex items-center gap-4">
                        <div class="text-2xl bg-white p-2 rounded-full shadow-sm">${event.icon}</div>
                        <div>
                            <div class="flex items-baseline gap-2">
                                <span class="font-bold text-indigo-800">${event.time}</span>
                                <span class="font-bold text-stone-800">${event.title}</span>
                            </div>
                            <p class="text-sm text-stone-600">${event.desc}</p>
                        </div>
                    </div>
                `).join('');

                contentHtml += `
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 relative">
                        <!-- Kids Column -->
                        <div class="relative">
                            <div class="sticky top-0 bg-white z-10 py-2 border-b-2 border-amber-400 mb-4">
                                <h3 class="font-bold text-amber-700 flex items-center gap-2">
                                    <span>👶 小孩組</span>
                                    <span class="text-xs font-normal text-stone-400">USJ 環球影城</span>
                                </h3>
                            </div>
                            ${kidsHtml}
                        </div>
                        
                        <!-- Elders Column -->
                        <div class="relative">
                             <div class="sticky top-0 bg-white z-10 py-2 border-b-2 border-stone-400 mb-4">
                                <h3 class="font-bold text-stone-700 flex items-center gap-2">
                                    <span>🧓 長輩組</span>
                                    <span class="text-xs font-normal text-stone-400">奈良古都漫遊</span>
                                </h3>
                            </div>
                            ${eldersHtml}
                        </div>
                        
                        <!-- Vertical Divider for Desktop -->
                        <div class="hidden md:block absolute left-1/2 top-10 bottom-0 w-px bg-stone-200 -ml-px"></div>
                    </div>
                    ${commonHtml}
                </div>`; // Close animate-fade-in

            } else {
                // Standard Render for other days
                let eventsHtml = '';
                if(data.events) {
                    data.events.forEach((event, index) => {
                        eventsHtml += `
                            <div class="relative pl-8 pb-8 group">
                                <div class="timeline-line ${index === data.events.length - 1 ? 'hidden' : ''}"></div>
                                <div class="absolute left-0 top-0 w-10 h-10 bg-white border-2 border-stone-200 rounded-full flex items-center justify-center text-xl z-10 shadow-sm group-hover:border-amber-400 transition-colors">
                                    ${event.icon}
                                </div>
                                <div class="ml-4 bg-stone-50 p-4 rounded-xl hover:shadow-md transition-shadow">
                                    <div class="flex flex-wrap items-baseline gap-2 mb-1">
                                        <span class="font-bold text-amber-700 text-lg">${event.time}</span>
                                        <h4 class="font-bold text-stone-800 text-lg">${event.title}</h4>
                                    </div>
                                    <p class="text-stone-600 text-sm">${event.desc}</p>
                                </div>
                            </div>
                        `;
                    });
                }
                contentHtml += `<div class="relative mt-4">${eventsHtml}</div></div>`; // Close animate-fade-in
            }

            container.innerHTML = contentHtml;
        }

        function renderPackingList() {
            const container = document.getElementById('packing-list-container');
            let html = '';

            // Render Carry-On
            html += `<div class="mb-3"><h3 class="font-bold text-amber-700 text-sm mb-2 sticky top-0 bg-white py-1">🎒 隨身行李建議 (電池類必帶)</h3><div class="space-y-2">`;
            html += packingList.carryOn.map((item) => `
                <label class="flex items-center space-x-3 p-3 bg-stone-50 rounded-lg cursor-pointer hover:bg-amber-50 transition border border-stone-100">
                    <input type="checkbox" class="form-checkbox h-5 w-5 text-amber-600 rounded focus:ring-amber-500 border-stone-300" onchange="updatePackProgress()">
                    <span class="text-2xl">${item.icon}</span>
                    <span class="text-stone-700 font-medium">${item.name}</span>
                </label>
            `).join('');
            html += `</div></div>`;

            // Render Checked
            html += `<div class="mb-3"><h3 class="font-bold text-stone-700 text-sm mb-2 sticky top-0 bg-white py-1">🧳 託運行李建議</h3><div class="space-y-2">`;
            html += packingList.checked.map((item) => `
                <label class="flex items-center space-x-3 p-3 bg-stone-50 rounded-lg cursor-pointer hover:bg-stone-100 transition border border-stone-100">
                    <input type="checkbox" class="form-checkbox h-5 w-5 text-stone-500 rounded focus:ring-stone-400 border-stone-300" onchange="updatePackProgress()">
                    <span class="text-2xl">${item.icon}</span>
                    <span class="text-stone-700 font-medium">${item.name}</span>
                </label>
            `).join('');
            html += `</div></div>`;

            container.innerHTML = html;
        }

        function updatePackProgress() {
            const total = packingList.carryOn.length + packingList.checked.length;
            const checked = document.querySelectorAll('#packing-list-container input:checked').length;
            const pct = Math.round((checked / total) * 100);
            document.getElementById('pack-progress').innerText = `${pct}% 已完成`;
        }

        function updateCountdown() {
            const target = new Date('2026-02-25T00:00:00').getTime();
            const now = new Date().getTime();
            const diff = target - now;
            const days = Math.ceil(diff / (1000 * 60 * 60 * 24));
            
            // 更新 Header 的倒數標記
            const badgeEl = document.getElementById('countdown-badge');
            if (badgeEl) {
                if(days <= 0) {
                    badgeEl.innerText = "旅程進行中！";
                    badgeEl.classList.remove('bg-amber-100', 'text-amber-800');
                    badgeEl.classList.add('bg-green-100', 'text-green-800');
                } else {
                    // 修正倒數天數顯示格式
                    badgeEl.innerText = `距離2/25出發日還有：${days}天`;
                }
            }
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('地址已複製！');
            });
        }

        // --- INIT ---
        window.addEventListener('load', () => {
            updateCountdown();
            initCharts();
            renderDailyPlan(1); // Default to Day 1
            renderPackingList();
        });

        // Add simple fade-in animation
        const style = document.createElement('style');
        style.innerHTML = `
            @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
            .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
        `;
        document.head.appendChild(style);

    </script>
</body>
</html>